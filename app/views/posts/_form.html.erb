<%= form_with model: @post, url: {action: "create"}, local:true do |form| %>
  <% if @post.errors.any? %>
    <div id="error_explanation">
      <h2>Có
        <%= pluralize(@post.errors.count, "")%>lỗi:</h2>
      <ul>
        <% @post.errors.full_messages.each do |message| %>
          <li>
            <%= message %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- THÔNG TIN CƠ BẢN -->
  <div class="form-group row">
      <div class="col-sm-12 row">
      <label class="col-sm-2 col-form-label"> Tiêu Đề (<span style="color:red;">*</span>):</label>
      <div class="col-sm-10">
        <%= form.text_field :title, id: :post_title, class:"form-control", placeholder:"Vui lòng nhập tiêu đề tin đăng của bạn. Tối thiểu là 30 ký tự và tối đa là 99 ký tự." %>
    </div>
  </div>
  </div>
  <!-- Row Hình thức -->
  <div class="form-group row">
    <div class="col-sm-6 row">
      <label class="col-sm-4 col-form-label">Hình Thức (<span style="color:red;">*</span>) :</label>
      <div class="col-sm-8">
        <%= form.collection_select(:category_id, Category.where(super_id: nil), :id, :name, 
        {prompt: '-- Hình Thức --'},{class:"custom-select", id:'cate_id'}) %>
      </div>
    </div>

    <div class="col-sm-6 row">
        <label class="col-sm-3 col-form-label"> Loại (<span style="color:red;">*</span>) :</label>
        <div class="col-sm-9">
            <%= form.select :category_detail_id, "<option></option>", 
              {prompt:'--Phân Mục--'},{class:"custom-select", id:'cate_detail_id'}%>
        </div>
    </div>   
  </div>
  <!-- End Row Hình thức -->

  <!-- Row Quận -->
  <div class="form-group row">
      <div class="col-sm-6 row">
        <label class="col-sm-4 col-form-label">Tỉnh/Thành Phố (<span style="color:red;">*</span>) :</label>
        <div class="col-sm-8">
          <%= form.collection_select(:city_id, City.all, :id, :name, 
            {prompt: '-- Tỉnh/Thành Phố --'}, {class:"custom-select", id:'city_details'}) %>
        </div>
      </div>

      <div class="col-sm-6 row">
          <label class="col-sm-3 col-form-label"> Quận/Huyện (<span style="color:red;">*</span>) :</label>
          <div class="col-sm-9">
              <%= form.select :district_id, "<option></option>", 
              {prompt:'--Quận Huyện--'},{class:"custom-select", id:'district_details'}%>
          </div>
      </div>          
    </div>
    <!-- End Row Quận-->

  <!-- Row Phường  -->
  <div class="form-group row">
    <div class="col-sm-6 row">
      <label class="col-sm-4 col-form-label">Phường/Xã:</label>
      <div class="col-sm-8">
          <%= form.select :ward_id, "<option></option>", 
          {prompt:'-- Phường/Xã --'},{class:"custom-select", id:'ward_details'}%>
      </div>
    </div>
    <div class="col-sm-6 row">
        <label class="col-sm-3 col-form-label">Đường/Phố:</label>
        <div class="col-sm-9">
            <%= form.select :street_id, "<option></option>", 
            {prompt:'-- Đường Phố --'},{class:"custom-select", id:'street_details'}%>
        </div>
    </div>          
  </div>
  <!-- End Row Phường-->

<!-- Row Dự Án - Diện Tích  -->
<div class="form-group row">
    <div class="col-sm-6 row">
      <label class="col-sm-4 col-form-label">Dự Án:</label>
      <div class="col-sm-8">
          <%= form.select :project, "<option></option>", 
          {prompt:'-- Dự Án --'},{class:"custom-select", id:'project_details'}%>
      </div>
    </div>
    <div class="col-sm-6 row">
        <label class="col-sm-3 col-form-label">Diện Tích:</label>
        <div class="col-sm-6">
          <%= form.text_field :area, id: :post_area, class:"form-control" %>
        </div>
        <div class="col-sm-2">m2</div>
    </div>          
  </div>
  <!-- End Row  Dự Án - Diện Tích-->

  <!-- Row Giá - Đơn Vị  -->
<div class="form-group row">
    <div class="col-sm-6 row">
      <label class="col-sm-4 col-form-label">Giá:</label>
      <div class="col-sm-8">
        <%= form.text_field :price, id: :post_price, class:"form-control"%>
      <!-- if unit.key = 1 :post_price = "" -->        
      </div>
    </div>
    <div class="col-sm-6 row">
        <label class="col-sm-3 col-form-label"> Đơn Vị:</label>
        <div class="col-sm-9">
            <%= form.select :unit, [['Thỏa Thuận', 1], ['Triệu', 2], ['Tỷ', 3], ['Trăm nghìn/m2', 4], ['Triệu/m2', 5]], 
            {prompt:false},{class:"custom-select"}%>
        </div>
    </div>          
  </div>
  <!-- End Row  Giá - Đơn Vị -->
      <div class="field">
        Tổng Giá Tiền:
        <!-- if unit.key = 2 :post_price * 1000000 
    if unit.key = 3 :post_price * 1000000000
    if unit.key = 4 :post_price * :area * 100000
    if unit.key = 5 :post_price * :area * 1000000 
    if unit.key = 1 Thoả Thuận, :price = ""
    else -->
      </div>
      <div class="field">
        Địa Chỉ (
        <span style="color:red;">*</span>) :
        <%= form.text_field :address_number, id: :post_address_number %>
      </div>
      <!-- THÔNG TIN CƠ BẢN -->

      <!-- THÔNG TIN MÔ TẢ -->
      <div class="field">
        <small>(
          <span style="color:red;">*</span>) Tối đa chỉ 3000 ký tự</small>
        <%= form.text_area :description, id: :post_description %>
          <small>
            Giới thiệu chung về bất động sản của bạn. Ví dụ: Khu nhà có vị trí thuận lợi: Gần công viên, gần trường học ... Tổng diện
            tích 52m2, đường đi ô tô vào tận cửa.
          </small>
          <br>
          <small style="color:red;">Lưu ý: tin rao chỉ để mệnh giá tiền Việt Nam Đồng.</small>
      </div>

      <!-- THÔNG TIN KHÁC -->
      <div class="field">
        Mặt Tiền (m):
        <%= form.text_field :front, id: :post_front %>
      </div>

      <div class="field">
        Đường vào (m):
        <%= form.text_field :entrance, id: :post_entrance %>
      </div>

      <div class="field">
        Hướng Nhà:
        <%= select(:post, :house_direction, 
    [['Đông', 1], ['Tây', 2], ['Nam', 3], ['Bắc', 4]]) %>
      </div>

      <div class="field">
        Hướng Ban Công:
        <%= select(:post, :balcony_direction, 
    [['Đông', 1], ['Tây', 2], ['Nam', 3], ['Bắc', 4]]) %>
      </div>
      <div class="field">
        Số Tầng:
        <%= form.number_field :floor, id: :post_floor, in: 0..999 %>
      </div>

      <div class="field">
        Số Phòng Ngủ:
        <%= form.number_field :bedroom, id: :post_bedroom, in: 0..999 %>
      </div>

      <div class="field">
        Số Toilet:
        <%= form.number_field :toilet, id: :post_toilet, in: 0..999 %>
      </div>
      <div class="field">
        Nội Thất:
        <%= form.text_area :furniture, id: :post_furniture %>
      </div>
      <!-- THÔNG TIN KHÁC -->

      <!-- HÌNH ẢNH VÀ VIDEO chưa làm -->
      <small>Tối đa 8 ảnh với tin thường và 16 với tin VIP. Mỗi ảnh tối đa 2MB </small>
      <br>
      <small>Tin rao có ảnh sẽ được xem nhiều hơn gấp 10 lần và được nhiều người gọi gấp 5 lần so với tin rao không có ảnh. Hãy
        đăng ảnh để được giao dịch nhanh chóng!</small>
      <!-- BẢN ĐỒ  chưa làm-->

      <!-- <div class="field">
    <%= form.label :lng %>
    <%= form.text_field :lng, id: :post_lng %>
  </div>

  <div class="field">
    <%= form.label :lat %>
    <%= form.text_field :lat, id: :post_lat %>
  </div> -->

      <!-- LIÊN HỆ -->
      <div class="field">
        Tên Liên Hệ:
        <%= form.text_field :contact_name, id: :post_contact_name %>
      </div>

      <div class="field">
        Địa Chỉ:
        <%= form.text_field :contact_address, id: :post_contact_address %>
      </div>

      <div class="field">
        Điện Thoại:
        <%= form.text_field :contact_phone, id: :post_contact_phone %>
      </div>

      <div class="field">
        Di Dộng (
        <span style="color:red;">*</span>) :
        <%= form.text_field :contact_mobile, id: :post_contact_mobile %>
      </div>

      <div class="field">
        Email:
        <%= form.text_field :contact_mail, id: :post_contact_mail %>
      </div>
      <!-- LIÊN HỆ -->
      <div class="actions">
        <%= form.submit %>
      </div>
      <% end %>



<script>
  //Ajax kiểm tra Hình thức - Loại
  $(function() {
    $('#cate_id').change(function(){
      var value = $(this).val();
      $('#cate_detail_id').html("<option>--Phân Mục--</option>"); //clear option 
      $.get("new", {
       category_id: value
      },
      function(data, status){
        data.forEach(item => {
            $('#cate_detail_id').append("<option value="+item.id+ ">"+ item.name + "</option>")
        });
      })
    });
  });
  //Ajax kiểm tra TP - Quận
  $(function() {
    $('#city_details').change(function(){
      var value = $(this).val();
      $('#district_details').html("<option>--Quận Huyện--</option>"); //clear option 
      $.get("new", {
       city_id: value
      },
      function(data, status){
        data.forEach(item => {
            $('#district_details').append("<option value="+item.id+ ">"+ item.name + "</option>")
        });
      })
    });
  });
  //Ajax kiểm tra Quận - Phường
  $(function() {
    $('#district_details').change(function(){
      var value = $(this).val();
      $('#ward_details').html("<option>-- Phường/Xã  --</option>"); //clear option 
      $.get("new", {
       district_id: value
      },
      function(data, status){
        data.forEach(item => {
            $('#ward_details').append("<option value="+item.id+ ">"+ item.name + "</option>")
        });
      })
    });
  })
  //Ajax kiểm tra Phường - Đường
  $(function() {
    $('#ward_details').change(function(){
      var value = $(this).val();
      $('#street_details').html("<option>-- Đường Phố --</option>"); //clear option 
      //check empty key...
      $.get("new", {
       ward_id: value
      },
      function(data, status){
        data.forEach(item => {
            $('#street_details').append("<option value="+item.id+ ">"+ item.name + "</option>")
        });
      })
    });
  })
</script>